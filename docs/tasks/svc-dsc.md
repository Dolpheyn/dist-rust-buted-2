# SVC-DSC - Service Discovery svc

- Create a service discovery system.
  - At the root of module.
  - Endpoints: RegisterService, DeregisterService
  - Basic DynamoDB table
    - PK: ServiceGroup, SK: ServiceName, IP:port (string)

## SVC-DSC-7 - Server sends heartbeat, Service discovery listens [PR](https://github.com/Dolpheyn/dist-rust-buted/pull/13)

- [x] Save last register message timestamp in service map
- [x] after svc-dsc is served, check each service in map in interval (10 secs).
  - If timestamp is more than 10 seconds ago, assume service is dead, deregister service.
- [x] After serving registered services, call register in intervals(10 secs).

## SVC-DSC-6 - Client sdk

- [x] Add .env file storing serdict's port
- [x] Make client.rs expose a SerDictClient object

## SVC-DSC-5 - ListServiceByGroupName

- [x] Add endpoint: ListServiceByGroupName
  - ListServiceByGroupName(ListServiceByGroupNameRequest) returns ListServiceByGroupNameResponse
    - ListServiceByGroupNameRequest: group string
    - ListServiceByGroupNameResponse: repeats GetServiceResponse
      - Using existing ListServiceResponse instead

## SVC-DSC-4 - GetService & ListService [PR](https://github.com/Dolpheyn/dist-rust-buted/pull/5)

- [x] Implement endpoints: GetService & ListService

## SVC-DSC-3 [PR](https://github.com/Dolpheyn/dist-rust-buted/pull/4)

- [x] Implement endpoints: RegisterService & DeregisterService

## SVC-DSC-2: In-memory service dictionary [PR](https://github.com/Dolpheyn/dist-rust-buted/pull/3)

- [x] Add a concurrent map to store services
  - Key: `type ServiceId = Tuple(group, svc-name)`
  - Val: `type ServiceAddr = Tuple(ip, port)`
  - Must have indirection bcs methods in server interface generated by tonic does not accept `&mut self`
    - Maybe wrap in `Rc<Mutex>>`
      - `services: Rc<Mutex<HashMap<ServiceId, ServiceAddr>>`

## SVC-DSC-1 - Generate [PR](https://github.com/Dolpheyn/dist-rust-buted/pull/2)

- [x] Generate endpoints and types RegisterService(RegisterServiceRequest) returns RegisterServiceResponse
    - RegisterServiceRequest: group string, name string
    - RegisterServiceResponse: ip string, port number
  - DeregisterService(DeregisterServiceRequest) returns DeregisterServiceResponse:
    - DeregisterServiceRequest: group string, name string
    - DeregisterServiceResponse: empty
  - GetService(GetServiceRequest) returns GetServiceResponse
    - GetServiceRequest: group string, name string
    - GetServiceResponse: group string, name string, ip string, port number
  - ListService(ListServiceRequest) returns ListServiceResponse
    - ListServiceRequest: empty
    - ListServiceResponse: repeats GetServiceResponse

## SVC-DSC-0 - Init [PR](https://github.com/Dolpheyn/dist-rust-buted/pull/1)

- [x] Make gRPC gen from protobuf works using tonic
